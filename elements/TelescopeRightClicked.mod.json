{
  "_fv": 66,
  "_type": "procedure",
  "definition": {
    "procedurexml": "<xml xmlns=\"https://developers.google.com/blockly/xml\"><block type=\"wait\" x=\"-1381\" y=\"-566\"><value name=\"ticks\"><block type=\"math_number\"><field name=\"NUM\">20</field></block></value><statement name=\"do\"><block type=\"java_code\"><field name=\"CODE\">if (world.isClientSide()) {&amp;#10;    Minecraft.getInstance().tell(() -&gt; {&amp;#10;        System.out.println(\"[DEBUG] opening telescope via tell()\");&amp;#10;        Minecraft.getInstance().setScreen(new net.code.thisnotamod.client.gui.TelescopeScreen());&amp;#10;    });&amp;#10;}&amp;#10;</field></block></statement></block><block type=\"event_trigger\" deletable=\"false\" x=\"-358\" y=\"186\"><field name=\"trigger\">no_ext_trigger</field><next><block type=\"block_animation\"><value name=\"value\"><block type=\"math_number\"><field name=\"NUM\">1</field></block></value><value name=\"x\"><block type=\"coord_x\"></block></value><value name=\"y\"><block type=\"coord_y\"></block></value><value name=\"z\"><block type=\"coord_z\"></block></value><next><block type=\"controls_if\"><value name=\"IF0\"><block type=\"logic_binary_ops\"><field name=\"OP\">OR</field><value name=\"A\"><block type=\"math_binary_ops\"><field name=\"OP\">EQ</field><value name=\"A\"><block type=\"block_get_blockstate\"><value name=\"block\"><block type=\"blockstate_from_deps\"></block></value></block></value><value name=\"B\"><block type=\"math_number\"><field name=\"NUM\">0</field></block></value></block></value><value name=\"B\"><block type=\"math_binary_ops\"><field name=\"OP\">EQ</field><value name=\"A\"><block type=\"block_get_blockstate\"><value name=\"block\"><block type=\"blockstate_from_deps\"></block></value></block></value><value name=\"B\"><block type=\"math_number\"><field name=\"NUM\">1</field></block></value></block></value></block></value><statement name=\"DO0\"><block type=\"block_animation\"><value name=\"value\"><block type=\"math_number\"><field name=\"NUM\">1</field></block></value><value name=\"x\"><block type=\"coord_x\"></block></value><value name=\"y\"><block type=\"coord_y\"></block></value><value name=\"z\"><block type=\"coord_z\"></block></value><next><block type=\"wait\"><value name=\"ticks\"><block type=\"math_number\"><field name=\"NUM\">20</field></block></value><statement name=\"do\"><block type=\"block_set_blockstate\"><value name=\"x\"><block type=\"coord_x\"></block></value><value name=\"y\"><block type=\"coord_y\"></block></value><value name=\"z\"><block type=\"coord_z\"></block></value><value name=\"value\"><block type=\"math_number\"><field name=\"NUM\">2</field></block></value><next><block type=\"play_sound\"><field name=\"sound\">item.spyglass.use</field><field name=\"soundcategory\">block</field><value name=\"x\"><block type=\"coord_x\"></block></value><value name=\"y\"><block type=\"coord_y\"></block></value><value name=\"z\"><block type=\"coord_z\"></block></value><value name=\"level\"><block type=\"math_number\"><field name=\"NUM\">1</field></block></value><value name=\"pitch\"><block type=\"math_number\"><field name=\"NUM\">1</field></block></value><next><block type=\"entity_execute_command\"><value name=\"command\"><block type=\"text\"><field name=\"TEXT\">attribute @s minecraft:generic.movement_speed modifier add 3d952521-d8be-4e6d-9906-d1fb22ca3156 vps_binoculars -1 add</field></block></value><value name=\"entity\"><block type=\"entity_from_deps\"></block></value></block></next></block></next></block></statement><next><block type=\"java_code\"><field name=\"CODE\">// === CUSTOM SNIPPET: однократный слушатель отката по Esc/ПКМ ===&amp;#10;if (world instanceof Level _level &amp;&amp; _level.isClientSide()) {&amp;#10;\tif (!entity.getPersistentData().getBoolean(\"telescope_listener\")) {&amp;#10;\t\tentity.getPersistentData().putBoolean(\"telescope_listener\", true);&amp;#10;&amp;#10;\t\tfinal int fx = (int) x;&amp;#10;\t\tfinal int fy = (int) y;&amp;#10;\t\tfinal int fz = (int) z;&amp;#10;\t\tfinal String setBlockCmd = \"setblock \" + fx + \" \" + fy + \" \" + fz + \" thisnotamod:telescope[blockstate=1] replace\";&amp;#10;&amp;#10;\t\tfinal Object[] listenerRef = new Object[1]; // используем массив как контейнер для final listener&amp;#10;&amp;#10;\t\tObject listener = new Object() {&amp;#10;&amp;#10;\t\t\t@SubscribeEvent&amp;#10;\t\t\tpublic void onKey(InputEvent.Key event) {&amp;#10;\t\t\t\tif (event.getAction() == GLFW.GLFW_PRESS &amp;&amp; event.getKey() == GLFW.GLFW_KEY_ESCAPE) {&amp;#10;\t\t\t\t\thandleClose();&amp;#10;\t\t\t\t}&amp;#10;\t\t\t}&amp;#10;&amp;#10;\t\t\t@SubscribeEvent&amp;#10;\t\t\tpublic void onMouse(InputEvent.MouseButton event) {&amp;#10;\t\t\t\tif (event.getAction() == GLFW.GLFW_PRESS &amp;&amp; event.getButton() == GLFW.GLFW_MOUSE_BUTTON_RIGHT) {&amp;#10;\t\t\t\t\thandleClose();&amp;#10;\t\t\t\t}&amp;#10;\t\t\t}&amp;#10;&amp;#10;\t\t\tprivate void handleClose() {&amp;#10;\tif (Minecraft.getInstance().player != null) {&amp;#10;\t\tString blockCmd = \"execute as @s run \" + setBlockCmd;&amp;#10;\t\tString attrCmd = \"attribute @s minecraft:generic.movement_speed modifier remove 3d952521-d8be-4e6d-9906-d1fb22ca3156\";&amp;#10;&amp;#10;\t\t// Выполняем как unsigned команды — не выводятся в чат&amp;#10;\t\tMinecraft.getInstance().getConnection().sendUnsignedCommand(blockCmd);&amp;#10;\t\tMinecraft.getInstance().getConnection().sendUnsignedCommand(attrCmd);&amp;#10;\t}&amp;#10;&amp;#10;\tMinecraftForge.EVENT_BUS.unregister(listenerRef[0]);&amp;#10;\tentity.getPersistentData().putBoolean(\"telescope_listener\", false);&amp;#10;}&amp;#10;\t\t};&amp;#10;&amp;#10;\t\tlistenerRef[0] = listener; // сохраняем в контейнер&amp;#10;\t\tMinecraftForge.EVENT_BUS.register(listener);&amp;#10;\t}&amp;#10;}&amp;#10;</field></block></next></block></next></block></statement></block></next></block></next></block></xml>"
  }
}